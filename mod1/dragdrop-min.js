var browserPos=null;function setFormValueOpenBrowser(c,b){var a=T3_TV_MOD1_BACKPATH+"browser.php?mode="+c+"&bparams="+b;browserWin=window.open(a,"templavoilareferencebrowser","height=350,width="+(c=="db"?650:600)+",status=0,menubar=0,resizable=1,scrollbars=1");browserWin.focus()}function setFormValueFromBrowseWin(f,e,c,a){if(e){var b=e.split("_");var d=b.pop();b=b.join("_");browserPos.href=browserPos.rel.replace("%23%23%23",b+":"+d);jumpToUrl(browserPos.href)}}function jumpToUrl(a){window.location.href=a;return false}function jumpExt(a,b){var c=b?b:"";window.location.href=a+(T3_THIS_LOCATION?"&returnUrl="+T3_THIS_LOCATION:"")+c;return false}function jumpSelf(a){window.location.href=a+(T3_RETURN_URL?"&returnUrl="+T3_RETURN_URL:"");return false}function setHighlight(a){top.fsMod.recentIds.web=a;top.fsMod.navFrameHighlightedID.web="pages"+a+"_"+top.fsMod.currentBank;if(top.content&&top.content.nav_frame&&top.content.nav_frame.refresh_nav){top.content.nav_frame.refresh_nav()}}function editRecords(c,b,d,a){window.location.href=T3_TV_MOD1_BACKPATH+"alt_doc.php?returnUrl="+T3_TV_MOD1_RETURNURL+"&edit["+c+"]["+b+"]=edit"+d}function editList(b,a){var c="";var d=0;var e=a.indexOf(",");while(e!=-1){if(cbValue(b+"|"+a.substr(d,e-d))){c+=a.substr(d,e-d)+","}d=e+1;e=a.indexOf(",",d)}if(cbValue(b+"|"+a.substr(d))){c+=a.substr(d)+","}return c?c:a}var sortable_currentItem;function sortable_unhideRecord(a,b){jumpToUrl(b)}function sortable_hideRecord(a,b){if(!sortable_removeHidden){return jumpToUrl(b)}while((typeof a.className=="undefined")||(a.className.search(/tpm-element(?!-)/)==-1)){a=a.parentNode}new Ajax.Request(b);new Effect.Fade(a,{duration:0.5,afterFinish:sortable_hideRecordCallBack})}function sortable_hideRecordCallBack(b){var a=b.element;while(a.lastChild){a.removeChild(a.lastChild)}}function sortable_unlinkRecordCallBack(b){var a=b.parent();b.remove();sortable_update(a)}function sortable_unlinkRecord(a,c,b){new TYPO3.jQuery.ajax({url:TYPO3.settings.ajaxUrls["Extension\\Templavoila\\Module\\Mod1\\Ajax::unlinkRecord"],type:"post",cache:false,data:{unlink:a}}).done(function(d){new TYPO3.jQuery("#"+c).fadeTo("fast",0,function(){sortable_unlinkRecordCallBack(TYPO3.jQuery(this))})})}function sortable_unlinkRecordSidebarCallBack(d){var c=$("tx_templavoila_mod1_sidebar-bar").childElements();var b=0;for(var a=0;a<c.length;a++){b+=c[a].getHeight()}$("tx_templavoila_mod1_sidebar-bar").morph({height:b+"px"},{duration:0.1,afterFinish:function(){$("tx_templavoila_mod1_sidebar-bar").setStyle({height:"auto"});if(d&&$(d)){$(d).highlight()}}})}function sortable_updateItemButtons(d,a,b){var e=[],f=[];var c=escape(b+a);d.childElements().each(function(g){if(g.nodeName=="A"&&g.href){switch(g.className){case"tpm-new":g.href=g.href.replace(/&parentRecord=[^&]+/,"&parentRecord="+c);break;case"tpm-browse":if(g.rel){g.rel=g.rel.replace(/&destination=[^&]+/,"&destination="+c)}break;case"tpm-delete":g.href=g.href.replace(/&deleteRecord=[^&]+/,"&deleteRecord="+c);break;case"tpm-unlink":g.href=g.href.replace(/unlinkRecord\('[^']+'/,"unlinkRecord('"+c+"'");break;case"tpm-cut":case"tpm-copy":case"tpm-ref":g.href=g.href.replace(/CB\[el\]\[([^\]]+)\]=[^&]+/,"CB[el][$1]="+c);break;case"tpm-pasteAfter":case"tpm-pasteSubRef":g.href=g.href.replace(/&destination=[^&]+/,"&destination="+c);break;case"tpm-makeLocal":g.href=g.href.replace(/&makeLocalRecord=[^&]+/,"&makeLocalRecord="+c);break}}else{if(g.childElements()&&g.className!="tpm-subelement-table"){sortable_updateItemButtons(g,a,b)}}})}function sortable_update(c){var d=c.firstChild;var b=1;while(d!=null){if(!(typeof d.className=="undefined")&&d.className.search(/tpm-element(?!-)/)>-1){if(sortable_currentItem&&d.id==sortable_currentItem.id){var a=T3_TV_MOD1_BACKPATH+"ajax.php?ajaxID=Extension\\Templavoila\\Module\\Mod1\\Ajax::moveRecord&source="+all_items[sortable_currentItem.id]+"&destination="+all_items[c.id]+(b-1);new Ajax.Request(a);sortable_currentItem=false}sortable_updateItemButtons(d,b,all_items[c.id]);all_items[d.id]=all_items[c.id]+b;b++}d=d.nextSibling}}function sortable_change(a){sortable_currentItem=a}function tv_createSortable(a,b){Position.includeScrollOffsets=true;Position.prepare();Sortable.create(a,{tag:"div",ghosting:false,format:/(.*)/,handle:"sortable_handle",scroll:"typo3-docbody",scrollSpeed:30,dropOnEmpty:true,constraint:false,containment:b,onChange:sortable_change,onUpdate:sortable_update})};